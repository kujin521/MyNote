1.  实验名称

    图像的几何变换

2.  实验目的

> 能够使用OpenCV实现图像的缩放，错切和旋转。

3.  实验内容

    在实验二的基础上，添加缩放、旋转和平移所需的控件，实现图像的缩放、旋转和错切。

> （1）添加两个编辑框，用来接收用户输入缩放后的图像尺寸（宽和高），添加一个缩放按钮，并用一个Group Box将上述控件集中。
>
> （2）添加一个编辑框，用来接收用户输入的旋转角度，添加一个旋转按钮，并用一个Group Box将上述控件集中。
>
> （3）添加一个编辑框，用来接收用户输入的错切比，添加一个水平错切按钮和一个垂直错切按钮，并用一个Group Box将上述控件集中。
>
> 3.2 添加响应函数
>
> 为缩放按钮、旋转按钮、水平错切按钮、垂直错切按钮添加消息响应函数。
>
> 3.2 添加响应函数
>
> 为缩放按钮、旋转按钮、水平错切按钮、垂直错切按钮添加消息响应函数。
>
> 界面截图
>
> ![image-20201013195341893](C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20201013195341893.png)
>
> 核心代码
>
> ```c++
> void CDemo2Dlg::OnBnClickedResize()
> {
> 	// 缩放按钮 响应函数
> 
> 	UpdateData(TRUE);	//获取输入缩放的宽高数据
> 
> 	Mat dst;
> 	//resize缩放函数 src打开的图像 dst缩放后图像 缩放尺寸
> 	resize(src,dst, Size(m_width, m_height));
> 	//在新的窗口显示
> 	imshow("resize", dst);
> }
> ```
>
> ```c++
> void CDemo2Dlg::OnBnClickedRotatek()
> {
> 	// 旋转
> 
> 	UpdateData(TRUE);	//获取输入的角度值	
> 
> 	//两行三列 3*3 第三行是固定值001,获取前两行即可
> 	//矩阵数据时浮点型
> 	Mat rot_mat(2, 3, CV_32FC1); //旋转矩阵
> 	Mat dst;	//保存旋转结果的图像对象
> 
> 	//计算旋转之后的画布大小
> 	double sin_value = sin(m_angle * CV_PI / 180);	//正弦值
> 	double cos_value = cos(m_angle * CV_PI / 180);	//余弦值
> 
> 	//获取原图像的宽高
> 	int width = src.cols;
> 	int height = src.rows;
> 
> 	int rorate_width = (int)(height * fabs(sin_value) + width * fabs(cos_value));
> 	int rorate_height = (int)(width * fabs(sin_value) + height * fabs(cos_value));
> 
> 	//计算旋转矩阵
> 	Point center = Point(width / 2, height / 2);
> 	double angle = m_angle;
> 	double scale = 1;
> 
> 	rot_mat = getRotationMatrix2D(center, angle, scale);
> 
> 	//计算平移量
> 	rot_mat.at<double>(0, 2) += (rorate_width - width) / 2;
> 	rot_mat.at<double>(1, 2) += (rorate_height - height) / 2;
> 
> 	//利用仿射变换 进行旋转
> 	warpAffine(src, dst, rot_mat, Size(rorate_width, rorate_height));
> 
> 	imshow("rotate", dst);
> }
> ```
>
> ```c++
> void CDemo2Dlg::OnBnClickedHshar()
> {
> 	// 水平错切
> 
> 	UpdateData(TRUE);
> 
> 	Mat  dst;
> 
> 	Mat vShar_mat(2, 3, CV_32FC1);//水平错切矩阵
> 
> 	Point2f srcPoint[3]; //原图像中的3个点
> 
> 	Point2f dstPoint[3]; //目标图像的3个点
> 
> 	//原图像的点(x=列值,y=行值)
> 	srcPoint[0] = Point2f(0, 0);	//左上角
> 	srcPoint[1] = Point2f(0, src.rows);	//左下角
> 	srcPoint[2] = Point2f(src.cols, 0);//右上角
> 
> 	//目标图像上的点
> 	if (m_sharRotio >= 0) {	//向右错切
> 		dstPoint[0] = Point2f(src.rows * m_sharRotio, 0);//左上角 向上平移 
> 		dstPoint[1] = Point2f(0, src.rows);//左下角 无移动
> 		dstPoint[2] = Point2f(src.cols+ src.rows * m_sharRotio, 0);//右上角	原先位置+平移量
> 	}
> 	else {	//向左错切
> 		dstPoint[0] = Point2f(0, 0);//左上角 无变化
> 		dstPoint[1] = Point2f(src.rows*(-m_sharRotio),src.rows);//左下角 向右平移
> 		dstPoint[2] = Point2f(src.cols, 0);//右上角 无变换
> 	}
> 
> 	vShar_mat = getAffineTransform(srcPoint, dstPoint);	//通过三个点 计算变换矩阵
> 
> 	//计算变换后的画布大小
> 	int dst_width = src.cols + src.rows * fabs(m_sharRotio); //原图像的宽+变换比例的值
> 	int dst_height = src.rows;	//水平变换 高不变化
> 
> 	warpAffine(src, dst, vShar_mat, Size(dst_width, dst_height));
> 
> 	imshow("hshear", dst);
> 
> }
> ```
>
> 
>
> ```c++
> void CDemo2Dlg::OnBnClickedVshar()
> {
> 	//垂直错切
> 
> 	UpdateData(TRUE);
> 
> 	Mat  dst;
> 
> 	Mat vShar_mat(2, 3, CV_32FC1);//垂直错切矩阵
> 
> 	Point2f srcPoint[3]; //原图像中的3个点
> 
> 	Point2f dstPoint[3]; //目标图像的3个点
> 
> 	//原图像中的点
> 	srcPoint[0] = Point2f(0, 0);	//左上角
> 	srcPoint[1] = Point2f(0, src.rows);	//左下角
> 	srcPoint[2] = Point2f(src.cols, 0);//右上角
> 
> 	//目标图像上的点
> 	if (m_sharRotio >= 0) {	//
> 		dstPoint[0] = Point2f(0, src.cols* m_sharRotio);//左上角
> 		dstPoint[1] = Point2f(0, src.rows+ src.cols * m_sharRotio);//左下角
> 		dstPoint[2] = Point2f(src.cols, 0);//右上角
> 	}
> 	else {
> 		dstPoint[0] = Point2f(0, 0);//左上角
> 		dstPoint[2] = Point2f(0, src.rows);//左下角
> 		dstPoint[1] = Point2f(src.cols, src.cols * (-m_sharRotio));//右上角
> 	}
> 
> 	vShar_mat = getAffineTransform(srcPoint, dstPoint);	//通过三个点 计算变换矩阵
> 
> 	//计算变换后的画布大小
> 	int dst_width = src.cols; //宽不变
> 	int dst_height = src.rows+src.cols * fabs(m_sharRotio);	//高度发生变化
> 
> 	warpAffine(src, dst, vShar_mat, Size(dst_width, dst_height));
> 
> 	imshow("hshear", dst);
> }
> ```
>
> 

4.  总结

    基础知识点

> Static Text控件、Edit Control控件、缩放按钮（Button）控件、Group Box控件的添加。
>
> 扩展知识点
>
> resize（）函数用于图像的缩放；
>
> wrapAffine（）函数用于图像的旋转；

注：上机实验指实验地点在信电学院计算中心的上机，留存电子版即可。
