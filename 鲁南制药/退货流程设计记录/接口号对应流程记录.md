# 退货运输接口

> 退货流程，数据查询显示，数据变更控制

业务基本需求

**前置条件**

业务员通过申请退货审批流程填写 退货审批单 信息，提交后系统根据 退货信息 交给 质量管理部 或 商务部审核，审核通过的 由 运输部 进行分配运输

**流程概括**

退货运输由 运输部触发，由调度员进行退货单的筛选，分配车辆，运输控制

## 初始

触发流程，定义设计退货公司（流程传递要查询的公司，贝特 厚普 新时代 经营）

## 路线规划

### 14480 

（查询）触发退货流程查询

> 请求

| 参数 | 含义                                 |                                        |
| ---- | ------------------------------------ | -------------------------------------- |
| GS   | 数据公司（经营，厚普，贝特，新时代） | GS:["经营"，"厚普"，"贝特"，""新时代"] |
| YSFS | 退货单运输方式筛选（自运，委托）     | YSFS:"委外"                            |
|      |                                      |                                        |

> 响应

```json
{
    "ID":"2201",
    "cityName":"北京市",
    "BZJS":0,
    "child":[{
            "ID":"220106",
            "cityName":"东城区",
            "BZJS":0,
            "child":[{
                "DH":"经营_621080043",
                "DW":"2201060007",
                "city_p":"北京市",
                "city_s":"东城区",
                "hospitalName":"华润医药商业集团有限公司",
                "bzjs":0,
                "ysfs":"自运",
                "thyy":"非质量-产品落标"
            }]
    }]
}
```



### 14479 

（选择）根据单号组返回具体信息（已选择的多个单号）

> 请求

| 参数 | 含义                                |                                                              |
| ---- | ----------------------------------- | ------------------------------------------------------------ |
| DHS  | 已选择运输的单号（公司名_退货单号） | DHS: ["厚普_121040011", "经营_621060004", "厚普_121040011", "经营_621070169", "经营_621070169", "新时代_421070027",…] |
| GS   | 公司名称                            | "GS":["厚普","贝特","新时代","经营"]                         |
|      |                                     |                                                              |

> 响应

```json
ZJE: 0.9 #总金额
alldVolume: 0.013385625 #体积
alldWeight: 5.1 #重量
{
    "ID":"2201",
    "cityName":"北京市",
    "BZJS":0,
    "child":[{
            "ID":"220106",
            "cityName":"东城区",
            "BZJS":0,
            "child":[{
                "DH":"经营_621080043",
                "DW":"2201060007",
                "city_p":"北京市",
                "city_s":"东城区",
                "hospitalName":"华润医药商业集团有限公司",
                "bzjs":0,
                "ysfs":"自运",
                "thyy":"非质量-产品落标"
            }]
    }]
}
```



## 审批

### 14479 

（选择）根据单号组返回具体信息（已选择的多个单号）

> 请求

| 参数 | 含义                                |                                                              |
| ---- | ----------------------------------- | ------------------------------------------------------------ |
| DHS  | 已选择运输的单号（公司名_退货单号） | DHS: ["厚普_121040011", "经营_621060004", "厚普_121040011", "经营_621070169", "经营_621070169", "新时代_421070027",…] |
| GS   | 公司名称                            | "GS":["厚普","贝特","新时代","经营"]                         |
|      |                                     |                                                              |

> 响应

```json
ZJE: 0.9 #总金额
alldVolume: 0.013385625 #体积
alldWeight: 5.1 #重量
{
    "ID":"2201",
    "cityName":"北京市",
    "BZJS":0,
    "child":[{
            "ID":"220106",
            "cityName":"东城区",
            "BZJS":0,
            "child":[{
                DH: "经营_621090162"
               JE: 0.9
                bzjs: 1
                city_p: "海南省"
                city_s: "海口"
                dVolume: 0.013385625
                dWeight: 5.1
                hospitalName: "国药控股海南有限公司"
                isvaild: "已起运"
                thyy: "非质量-终端滞销"
                ysfs: "委外"
            }]
    }]
}
```



## 退货派车

> 选择运输司机，完成后生成运输记录

![image-20211110144702185](https://i.loli.net/2021/11/10/p7bEc5RixNWsXgu.png)

## 司机运输

### 14501 

根据多个单号查询单位名称，退货总包装件数

> 请求

| 参数 | 含义                                |                                                              |
| ---- | ----------------------------------- | ------------------------------------------------------------ |
| DHS  | 已选择运输的单号（公司名_退货单号） | DHS: ["厚普_121040011", "经营_621060004", "厚普_121040011", "经营_621070169", "经营_621070169", "新时代_421070027",…] |
|      |                                     |                                                              |
|      |                                     |                                                              |

> 响应

```json
[
    {
        ID: "2213020033",
        name: "华润福建医药有限公司",
        ZBZJS: 0
    },{
        ID: "2205070012",
        name: "上药科园信海通辽医药有限公司", 
        ZBZJS: 0
    }
]
```

### 14502 

根据单位编码和多个单号，查出所有审核通过且没有运输记录的退货单号信息

​	（考虑可以将未触发退货运输的退货单号，选中添加上，如果是新通过的退货单号，则退货运输主表中不存在该单号）

> 请求

```json
{
    "DW":"2213020033",
    "YSFS":"委外",
	"DHS": ["厚普_121040011", "经营_621060004", "厚普_121040011", "经营_621070169", "经营_621070169", "新时代_421070027"]
}
```

> 响应

```json
[
    {DH: "厚普_121040011", SN: "0003634", RQ: "2021/4/29 0:00:00", DW: "2213020033", THLX: "False", ZT: "2",…}
]
```

### 14504 

根据单号获取退货详细信息

> 请求

```json
{
	"DH": "厚普_121040011"
}
```

> 响应

```json
[
    {
        CP: "11215", 
        NAME: "小儿消积止咳颗粒_3g*10袋", 
        JLDW: "盒",
        ZSQSL: 1,
        child: [
            {
                DH: "厚普_121040011",
                XH: 1,
                CP: "11215", 
                PH: "20200602",
                SQSL: 1,
                JLDW: "盒"
        	},...
        ]
    }
]
```

## 扫码发货接单

未设计

## 业务员退货数量核准（修改）

### 14506 

（查询）根据单位编码，返回单位名称，单位退货总包装件数

> 请求

```json
{
    "DW":"2213020033",
	"DHS": ["厚普_121040011", "经营_621060004", "厚普_121040011", "经营_621070169", "经营_621070169", "新时代_421070027"]
}
```

> 响应

```json
[
    {
        NAME: "华润福建医药有限公司",
        ZBZJS: 0
    }
]
```

### 14495 

（修改）退货数量修改，根据单号修改包装件数，根据单号和序号修改具体盒数

DH:单号，BZJS：包装件数（总件数），THS：退货详细==》XH:行号，SQSL:申请的退货数量

> 请求

```json
{
    "DH":190001,
    "BZJS":1,
    "THS":[
        {
            "XH":1,
            "SQSL":100
        },
        {
            "XH":2,
            "SQSL":80
        }
    ]
}
```

> 响应

```
修改成功，或给出错误提示
```

## 审核起运



> 生成 运输机记录从表，退货单，等操作

![image-20211110145010248](https://i.loli.net/2021/11/10/AcgFvToSGICH7Ma.png)

## 结束旅程

> 由司机 点击结束行程 结束