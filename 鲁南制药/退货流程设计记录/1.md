##  退货运输计算体积和重量

```c#
public class TSMData
    {
        public string CP { get; set; }
        public decimal JS { get; set; }
        public decimal JE { get; set; }
    }

//定义物料参数
                CAdmin sysAdmin = new CAdmin(ref oDb);
                CMaterialTable dtMa = (CMaterialTable)sysAdmin.CMaterialTable;


//遍历 退货单号，添加公司名称
                foreach (var dt in tdbDataModels) {
                    //获取单号的体积 重量
                    //获取产品编号，件数
                    IDbCommand sc1 = tdb.Sql("select cp,round(SUM(ZHXS*SQSL)/ Unitfactor,0) JS ,round(SUM(zhxs*sqsl*dj)/10000.0,2) JE from(select DS.DH, DS.HH, DS.CP, (case when ds.fpje = 0 then ds.Price - ds.ZK else round(ds.FPJE / ds.FPSL, 2) end) dj,s.SQSL,s.ZHXS,m.Unitfactor from X_THSP_S s inner join Material m on s.CP = m.ID inner join X_DD_S ds on s.DDH = ds.DH and s.DDHH = ds.HH WHERE S.DH = @DH) temp group by cp, Unitfactor");
                    sc1.Parameter("DH", dt.DH);
                    var tsmdata = sc1.QueryMany<TSMData>();
                    foreach (var item in tsmdata)
                    {
                        CMaterial oMa = (CMaterial)dtMa.GetDictByID(item.CP);
                        dt.dVolume += oMa.dVolume * item.JS;
                        dt.dWeight += oMa.get_dWeight() * item.JS;
                        dt.JE += item.JE;
                    }

                    dt.DH = gs + "_" + dt.DH;
                }


```

```c#


```

